@{
  ViewBag.Title = "Product Inventory";
}

<h2>Product Inventory</h2>

<table id="products" class="jtable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Quantity</th>
      <th>Recommended Retail Price</th>
      <th>Purchase Value</th>
      <th>Sale Value</th>
    </tr>
  </thead>
  <tbody data-bind="foreach: stock">
    <tr>
      <td data-bind="text: Name"></td>
      <td data-bind="text: Quantity" class="number"></td>
      <td data-bind="text: RRP" class="number"></td>
      <td data-bind="text: PurchaseValue" class="number"></td>
      <td data-bind="text: SaleValue" class="number"></td>
    </tr>
  </tbody>
</table>

<script type="text/javascript">
  $(function() {
    var viewModel;
    updateModel();

    var hub = $.connection.liveUpdateHub;

    hub.client.updateStocks = function() {
      updateModel();
    };

    $.connection.hub.start().done(function () {
      // nothing for now
    });

    JTable.Setup();

    //
    
    function updateModel() {
      $.getJSON($.BASE_URL + "Stocks/GetStocks", function(data) {
        if (viewModel)
          ko.mapping.fromJS({ stock: data }, viewModel);
        else {
          viewModel = ko.mapping.fromJS({ stock: data });
          ko.applyBindings(viewModel);
        }
      });
    }
  });
</script>